# Lab2
       ## Цель работы       Исследовать простейшие алгоритмы детектирования объектов на изображении.              ## Теоретическая база              ### 1. Прямой поиск одного изображения на другом (template matching)       *Template matching* — метод, основанный на нахождении места на изображении,
       наиболее похожем на шаблон. “Похожесть” изображения задается определенной        метрикой. То есть, шаблон "накладывается" на изображение, и считается       расхождение между изображением и шаблоном. Положение шаблона,        при котором это расхождение будет минимальным, и будет означать 
       место искомого объекта.              ### 2. Поиск ключевых точек эталона на входном изображении с помощью ORB       ORB представляет собой сочетание детектора ключевых точек FAST и дескриптора BRIEF со многими модификациями для        повышения производительности.
       *Особая (ключевая) точка изображения* – это точка изображения, окрестность которой можно отличить от окрестности любой другой точки        изображения в некоторой другой окрестности особой точки. В качестве окрестности точки изображения для большинства 
       алгоритмов берётся прямоугольное окно, составляющее размер 5x5 пикселей. Процесс определения особых точек достигается        путём использования детектора и дескриптора.                После того, как особые точки найдены, вычисляют их дескрипторы, т.е. наборы признаков, характеризующие окрестность 
       каждой особой точки.         *FAST* - метод поиска особых точек, который завоевал большую популярность из-за своей вычислительной эффективности.        Для принятия решения о том, считать заданную точку **С** особой или нет, в этом методе рассматривается яркость пикселей
       на окружности с центром в точке **С** и радиусом 3       *BRIEF* – быстрый эвристический дескриптор, строится из 256 бинарных сравнений между яркостями пикселов на размытом изображении.                В ORB Предложено сначала вычислять ориентацию особой точки и затем проводить бинарные сравнения уже в соответствие с этой ориентацией. 
              ## Описание разработанной системы              Напишем алгоритм, который определит, есть ли изображение (шаблон) на оригинальной фотографии.         Подход будет заключаться в просмотре всех возможных **h x w** окон, которые соответствуют размеру шаблона, и попиксельной проверке. 
       Для этого надо найти интегральное изображение с помощью numpy и вычислить сумму внутри **h x w** шаблона, начиная с каждого пикселя.       ```       sat = im.cumsum(1).cumsum(0)
       tplsum = np.array([tpl[:, :, i].sum() for i in range(D)])       ```              Далее вычислим сумму **h x w** окон оригинального изображения и сравним ее с ранее найденной суммой, чтобы получить список "возможных окон".              ```       iA, iB, iC, iD = sat[:-h, :-w], sat[:-h, w:], sat[h:, :-w], sat[h:, w:]
       lookup = iD - iB - iC + iA       possible_match = np.where(np.logical_and.reduce([lookup[..., i] == tplsum[i] for i in range(D)]))       ```              Для получения окончательного результата проводим попиксельное сравнение       ```       for y, x in zip(*possible_match):
          if np.all(im[y+1:y+h+1, x+1:x+w+1] == tpl):             return (y+1, x+1)
       ```              Работа алгоритма ORB:                1) Особые точки обнаруживаются при помощи быстрого древовидного FAST на исходном изображении и на нескольких изображениях из пирамиды уменьшенных изображений.  
              2) Для обнаруженных точек вычисляется мера Харриса, кандидаты с низким значением меры Харриса отбрасываются.                3) Вычисляется угол ориентации особой точки. Для этого, сначала вычисляются моменты яркости для окрестности особой точки.
          Всё это авторы назвали «центроид ориентации». В итоге получаем некоторое направление для окрестности особой точки.                4) Имея угол ориентации особой точки, последовательность точек для бинарных сравнений в дескрипторе BRIEF поворачивается в соответствие с этим углом.  
       5) По полученным точкам вычисляется бинарный дескриптор BRIEF.              ## Результаты работы и тестирования системы              | Шаблон       | Template matching | ORB |       | ------------- |:------------------:| -----:|       | ![Результат работы tm](./1/1.jpg) | ![Результат работы tm](./2/1.jpg)| ![Результат работы orb](./2/1.png)|
       |![шаблон](./1/2.jpg) ![Результат работы tm](./2/2.jpg)| ![Результат работы orb](./2/2.png)|
       | ![Результат работы tm](./1/3.jpg)| ![Результат работы tm](./2/3.jpg)| ![Результат работы orb](./2/3.png) |
       |![Результат работы tm](./1/4.jpg)| ![Результат работы tm](./2/4.jpg)|![Результат работы orb](./2/4.png) |
       |![Результат работы tm](./1/5.jpg)|![Результат работы tm](./2/5.jpg)|![Результат работы orb](./2/5.png) |
       |![Результат работы tm](./1/6.jpg)|![Результат работы tm](./2/6.jpg) |Шаблон не найден||
       |![Результат работы tm](./1/7.jpg)|![Результат работы tm](./2/7.jpg)|![Результат работы orb](./2/7.png)|
       |![Результат работы tm](./1/8.jpg)|Шаблон не найден||![Результат работы orb](./2/8.png)|
       |![Результат работы tm](./1/9.jpg) |Шаблон не найден||![Результат работы orb](./2/9.png)|
       |![Результат работы tm](./1/10.jpg) |Шаблон не найден||![Результат работы orb](./2/10.png)|
              ## Выводы
              Как можем заметить, Template matching справляется со своей задачей наилучшим образом,
       если шаблон является частью искомого изображения, т.е. эти метрики требуют попиксельного соответствия.              Также отметим, что ORB хорошо справляется с поиском на фотографиях, но при изменении масштаба шаблона,
       алгоритм может показывать неточные результаты.         Точность распознования шаблона с помощью **Template matching** составила **90%**, а **ORB** только **40%**.                            ## Список использованной литературы       - https://habr.com/ru/company/joom/blog/445354/       - https://habr.com/ru/post/414459/
       - https://habr.com/ru/post/244541/       - https://vc.ru/dev/249864-poisk-izobrazheniy-po-fragmentu-s-pomoshchyu-orb
